{% extends 'base.html' %}
{% load i18n %} {% load l10n %}
{% load static %}

{% block title %}{% trans 'Planning' %}{% endblock %}

{% block script %}
    <script src="{% static 'js/schemes.js' %}"></script>
    <script src="{% static 'js/timepicker.js' %}"></script>
{% endblock %}

<!-- SIDE BAR -->
{% block sidebar %}
    <nav id="id_sidebar" class="tsa_sidebar">
        <div class="sidebar_header">
            <h3>{% trans 'Planning' %}</h3>
        </div>

        <div class="td_width_200 mx-2 my-2">
             <h6>
                <select id="id_select_customer"class="td_width_200" ></select>
                <option value="" disabled selected hidden>{% trans 'Select customer' %}...</option>
            </h6>

            <h6>
                <select id="id_select_order" class="td_width_200"></select>
            </h6>

            <table class="mt-4">
                <thead id="id_thead_scheme_select" ></thead>
                <tbody id="id_tbody_scheme_select"></tbody>
            </table>

             <table class="mt-4">
                <thead id="id_thead_shift_select"class="mx-1 my-1 "></thead>
                <tbody id="id_tbody_shift_select"></tbody>
            </table>

            <table class="mt-4 mb-5">
                <thead id="id_thead_team_select"class="mx-1 my-1 "></thead>
                <tbody id="id_tbody_team_select"></tbody>
            </table>


        </div>
    </nav>
{% endblock %}
<!-- END SIDE BAR -->

<!-- MODAL -->
{% block modal %}
<!-- =================== MODAL SCHEME  =================== -->
    <div class="modal fade" id="id_mod_scheme" tabindex="-1" role="dialog" aria-labelledby="id_modal_cont_label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-md " role="document">
            <div class="modal-content">
                <div class="modal-header tsa_bc_lightlightgrey">
                    <h4 id="id_mod_scheme_header" class="modal-title mx-2" >{% trans 'Add new scheme' %}</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div  id="id_mod_scheme_body" class="modal-body">
                    <div class="modal_container">

<!-- modal_body_left contains template select table -->
                        <div class="modal_body_left">
                            <div class="mod_flex mx-2 my-2">

                                <div class="form-group">
                                    <label for="id_mod_scheme_customer" class="mx-2 my-2">{% trans 'Customer' %}:</label>
                                    <select id="id_mod_scheme_customer" class="form-control"></select>
                                    <small id="id_mod_scheme_customer_err" class="color_invalid mx-2 display_hide"></small>
                                </div>
                                <div class="form-group">
                                    <label for="id_mod_scheme_order" class="mx-2 my-2">{% trans 'Order' %}:</label>
                                    <select id="id_mod_scheme_order" class="form-control"></select>
                                    <small id="id_mod_scheme_order_err" class="color_invalid mx-2 display_hide"></small>
                                </div>
                                <div class="form-group">
                                    <label for="id_mod_scheme_code" class="mx-2 my-2">{% trans 'Scheme' %}:</label>
                                    <input id="id_mod_scheme_code" type="text"
                                        autocomplete="off" ondragstart="return false;" ondrop="return false;"
                                        class="form-control"
                                        placeholder="{% trans 'Enter scheme name...' %}"
                                    >
                                    <small id="id_mod_scheme_code_err" class="color_invalid mx-2 display_hide"></small>
                                </div>

                                <div class="form-group">
                                    <label for="id_mod_scheme_cycle" class="mx-2 my-2">{% trans 'Cycle days' %}:</label>
                                    <input id="id_mod_scheme_cycle" type="number" value="7" min="0" max="366"
                                        autocomplete="off" ondragstart="return false;" ondrop="return false;"
                                        class="form-control">
                                    <div><small class="mx-2">{% trans 'Enter the length of the cycle in days, enter zero for once-only.' %}</small></div>
                                    <div><small id="id_mod_scheme_cycle_err" class="color_invalid mx-2 display_hide"></small></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer ">
                    <div id="id_mod_scheme_msg" class="mod_flex modal_body_left tsa_color_red mx-2"></div>
                    <div>
                        <button type="button"  class="btn btn-secondary" data-dismiss="modal">{% trans 'Cancel' %}</button>
                        <button id="id_mod_scheme_btn_save" type="button" class="btn btn-primary">{% trans 'Save' %}</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
<!-- =================== END MODAL SCHEME =================== -->
<!-- =================== MODAL COPYFROM TEMPLATE  =================== -->
    <div class="modal fade" id="id_mod_copyfrom" tabindex="-1" role="dialog" aria-labelledby="id_modal_cont_label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header tsa_bc_lightlightgrey">
                    <h4 id="id_mod_copyfrom_header" class="modal-title mx-2" >{% trans 'Copy from template' %}</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div  id="id_mod_copyfrom_body" class="modal-body">
                    <div class="modal_container">

<!-- modal_body_left contains template select table -->
                        <div class="modal_body_left mx-2 my-2">
                            <h5 class="mx-2" >{% trans 'Copy from template' %}:</h5>
                            <div>
                                <label for="id_mod_copyfrom_template" class="mx-2 my-2">{% trans 'Template' %}:</label>
                                <select id="id_mod_copyfrom_template" class="form-control"></select>
                                <small id="id_mod_copyfrom_template_err" class="color_invalid mx-2 display_hide"></small>
                            </div>
                        </div>
                        <div class="modal_body_left  mx-2 my-2">
                            <h5 class="mx-2" >{% trans 'To scheme' %}:</h5>
                                <div>
                                    <label for="id_mod_copyfrom_customer" class="mx-2 my-2">{% trans 'Customer' %}:</label>
                                    <select id="id_mod_copyfrom_customer" class="form-control"></select>
                                    <small id="id_mod_copyfrom_customer_err" class="color_invalid mx-2 display_hide"></small>
                                </div>
                                <div>
                                    <label for="id_mod_copyfrom_order" class="mx-2 my-2">{% trans 'Order' %}:</label>
                                    <select id="id_mod_copyfrom_order" class="form-control"></select>
                                    <small id="id_mod_copyfrom_order_err" class="color_invalid mx-2 display_hide"></small>
                                </div>

                                <div>
                                    <label for="id_mod_copyfrom_code" class="mx-2 my-2">{% trans 'Scheme name' %}:</label>
                                    <input id="id_mod_copyfrom_code" type="text"
                                        autocomplete="off" ondragstart="return false;" ondrop="return false;"
                                        class="form-control">
                                    <small id="id_mod_copyfrom_code_err" class="color_invalid mx-2"></small>
                                </div>
                                <!--
                                <div>

                                    <label for="id_mod_scheme_cycle" class="mx-2 my-2">{% trans 'Start date of cycle' %}:</label>
                                    <input id="id_mod_copyfrom_datestart" type="date"
                                        autocomplete="off" ondragstart="return false;" ondrop="return false;"
                                        class="form-control">
                                    <div><small id="id_mod_copyfrom_datestart_err" class="color_invalid mx-2 display_hide"></small></div>
                                </div>
                                -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer ">
                    <button id="id_mod_copyfrom_btn_save" type="button" class="btn btn-primary">{% trans 'Copy' %}</button>
                </div>

            </div>
        </div>
    </div>
<!-- =================== MODAL COPY TO TEMPLATE  =================== -->
    <div class="modal fade" id="id_mod_copyto" tabindex="-1" role="dialog" aria-labelledby="id_modal_cont_label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-md " role="document">
            <div class="modal-content">
                <div class="modal-header tsa_bc_lightlightgrey">
                    <h4 id="id_mod_copyto_header" class="modal-title mx-2" >{% trans 'Copy scheme to template' %}</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body mx-2 my-">
                    <div class="form-group">
                        <label for="id_mod_copyto_code" class="mx-2 my-2">{% trans 'Template name' %}:</label>
                        <input id="id_mod_copyto_code" type="text"
                            autocomplete="off" ondragstart="return false;" ondrop="return false;"
                            class="form-control">
                        <small id="id_mod_copyto_code_err" class="color_invalid mx-2 display_hide"></small>
                    </div>
                </div>

                <div class="modal-footer">
                    <button id="id_mod_copyto_btn_save" type="button" class="btn btn-primary">{% trans 'Save' %}</button>
                </div>

            </div>
        </div>
    </div>
<!-- =================== END MODAL COPY TO TEMPLATE  =================== -->
<!-- =================== MODAL EMPLOYEE  =================== -->
    <div class="modal fade" id="id_mod_employee" tabindex="-1" role="dialog" aria-labelledby="id_modal_cont_label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-md " role="document">
            <div class="modal-content">
                <div class="modal-header tsa_bc_lightlightgrey">
                    <h4 id="id_mod_employee_header" class="modal-title mx-2" >{% trans 'Employee' %}</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div  id="id_mod_employee_body" class="modal-body">
                    <div class="modal_container">

<!-- modal_body_left contains employee select table -->
                        <div class="modal_body_left">
                            <div class="content_subheader_left mx-1 my-1">
                                <div class="form-group">
                                    <input id="id_mod_employee_filter_employee"
                                        type="text"
                                        autocomplete="off"
                                        ondragstart="return false;"
                                        ondrop="return false;"
                                        class="form-control"
                                        placeholder="{% trans 'Type a few letters and select employee in the list ...' %}">
                                </div>


                                <div style="overflow-x:hidden;overflow-y:auto;height:400px;width:220px"> <!-- this div is necessary to get standard structure for FilterTableRows -->
                                    <table class="table tsa-tbl mx-1 my-1">
                                        <tbody id="id_mod_employee_tblbody" data-table="employee">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                </div>

            </div>
        </div>
    </div>
<!-- =================== END MODAL EMPLOYEE  =================== -->
<!-- =================== CONFIRM DELETE  =================== -->
    {% include 'includes/confirm_delete.html' %}
{% endblock %}
<!-- END MODAL -->

{% block content %}
    {% if user.is_authenticated %}

        <div class="popup display_hide" >
            <span class="popuptext" id="id_msgbox"></span>
        </div>

    <!-- =================== CONTAINER =================== -->
        <div class="container">

            <!-- CONTENT HEADER - LOADER -->
            <div class="mt-5">

                <!-- class content_header -->
                <div class="content_header">

                    <div class="content_subheader_left mx-2">
                        <h5 id="id_hdr_customer">{% trans "Scheme" %}</h5>
                    </div>

                    <!-- loader -->
                    <div class="content_header_middle mx-4">
                        <div id="id_loader" class="image_container XXXvisibility_hide">
                            <img  src="{% static 'img/loader.gif' %}" height="24" width="24">
                        </div>
                    </div>
                    <!-- loader -->
                </div>
                <!-- end class content_header -->


            </div>
            <!-- end CONTENT HEADER - LOADER -->

        <!-- box with scheme input elements -->
        <div class="mx-4 my-1">
             <div id="id_scheme_box"  class="content_header border_scheme">
                <div class="content_subheader_left mx-2">
                    <div>{% trans 'Scheme' %}*</div>
                    <input id="id_scheme_code" type="text" data-table="scheme" data-field="code"
                    class="td_width_120 my-1 pt-0 pb-0" autocomplete="off" readonly>
                </div>
                <div class="content_subheader_left mx-2">
                    <div>{% trans 'Cycle length' %}*</div>
                    <input id="id_scheme_cycle" type="number" data-table="scheme" data-field="cycle"
                    class="td_width_120 my-1 pt-0 pb-0" autocomplete="off" readonly>
                </div>
                <div class="content_subheader_left mx-2">
                    <div>{% trans 'Start date' %}</div>
                    <input id="id_scheme_datefirst" type="text" data-table="scheme" data-field="datefirst"
                    class="input_popup_date td_width_120 my-1 pt-0 pb-0" autocomplete="off" readonly>
                </div>
                <div class="content_subheader_left mx-2">
                    <div>{% trans 'End date' %}</div>
                    <input id="id_scheme_datelast" type="text" data-table="scheme" data-field="datelast"
                    class="input_popup_date td_width_120 my-1 pt-0 pb-0" autocomplete="off" readonly>
                </div>
                <div class="content_subheader_left mx-2">
                    <div>{% trans 'Hourly rate' %}</div>
                    <input id="id_scheme_pricerate" type="text" data-table="scheme" data-field="pricerate"
                    class="input_popup_date td_width_120 my-1 pt-0 pb-0" autocomplete="off" readonly>
                </div>
                 <div class="content_subheader_left mx-2">
                    <div>{% trans 'Billable' %}</div>
                    <div class="my-1 pt-0 pb-0">
                    <a id="id_scheme_billable" data-table="scheme" data-field="billable">
                        <img id="id_sel_img_billable" src="{% static 'img/stat00.png' %}" height="18" width="18">
                    </a>
                    </div>
                </div>
            </div>
        </div>
        <!-- END box with scheme input elements -->

        <!-- end class content_subheader mt-5 -->
        <!-- class content body mx-2 -->
        <div class="content_body mx-2">
            <div class="popup-container">
<!-- =================== POPUP DATE  =================== -->
                 <div id="id_popup_date_container" class="popup_box tsa_bc_lightlightgrey display_hide">
                     <input id="id_popup_date" type="date" class="tsa_transparent mx-4 my-1" ></input>
                 </div>
<!-- =================== POPUP WDY  =================== -->
                 <div id="id_popup_wdy" class="popup_box display_hide">
                     <div class="popup_header">
                        <label id="id_popup_wdy_header" class="mx-4 my-1" >{% trans 'Roster date' %}</label>
                        <button id="id_popup_wdy_close" type="button" class="close my-1" aria-label="Close">
                            <span class="popup_close" aria-hidden="true">&times;</span>
                        </button>
                     </div>
                     <div class="content_header_middle">
                        <input id="id_popup_wdy_rosterdate" class="input_text mx-4 my-1" ></input>
                     </div>
                     <div class="content_header_middle" >
                         <button id="id_popup_wdy_prev_month"  class=" btn btn-add" title="{% trans 'Previous month' %}">&#171;</button>
                         <button id="id_popup_wdy_prev_day" class="btn btn-add" title="{% trans 'Previous day' %}">&#8249;</button>
                         <button id="id_popup_wdy_today" class="btn btn-add" >{% trans 'Today' %}</button>
                         <button id="id_popup_wdy_nextday" class="btn btn-add" title="{% trans 'Next day' %}">&#8250;</button>
                         <button id="id_popup_wdy_nextmonth" class="btn btn-add" title="{% trans 'Next month' %}">&#187;</button>
                     </div>
                     <div class="content_subheader_right">
                         <button id="id_popup_wdy_save" class="btn btn-add">{% trans 'Save' %}</button>
                     </div>
                 </div>

<!-- =================== TIMEPICKER  =================== -->
                {% include 'includes/timepicker.html' %}
<!-- =================== DATA TABLE  =================== -->
                <table id="id_table_schemeitems" class="table table-condensed tsa-tbl mx-2 my-2">
                    <thead id="id_thead_items" class="thead-inverse"></thead>
                    <tbody id="id_tbody_items"></tbody>
                </table>
            </div>


        <div class="content_header">
            <div class="content_subheader_left">
                <button id="id_btn_dayup" title="{% trans 'Set all rosterdates one day earlier' %}" class="btn btn-add ml-2"> &uarr; </button>
                <button id="id_btn_daydown" title="{% trans 'Set all rosterdates one day later' %}" class="btn btn-add"> &darr; </button>
                <button id="id_btn_autofill" class="btn btn-add">{% trans 'Fill scheme' %}</button>
                <button id="id_btn_scheme_delete" class="btn btn-add">{% trans 'Delete all shifts from this scheme' %}</button>
            </div>
        </div>

        </div>
    </div>
<!--</div> flex_container -->

        <div id="id_data"
            data-imgsrc_inactive = "{% static 'img/inactive_black.png' %}"
            data-imgsrc_active = "{% static 'img/inactive_grey.png' %}"
            data-imgsrc_active_lightgrey = "{% static 'img/inactive_lightgrey.png' %}"
            data-imgsrc_delete="{% static 'img/delete.gif' %}"
            data-imgsrc_warning="{% static 'img/warning.gif' %}"
            data-imgsrc_b_black = "{% static 'img/b_black.png' %}"
            data-imgsrc_b_grey = "{% static 'img/b_grey.png' %}"
            data-imgsrc_d_black = "{% static 'img/d_black.png' %}"
            data-imgsrc_d_grey = "{% static 'img/d_grey.png' %}"
            data-imgsrc_rest_black = "{% static 'img/rest_black.png' %}"
            data-imgsrc_cross_red = "{% static 'img/cross_red.png' %}"
            data-imgsrc_cross_grey = "{% static 'img/cross_grey.png' %}"
            data-imgsrc_stat00="{% static 'img/stat00.png' %}"

            data-lang ="{{ lang }}"
            data-timezone ="{{ timezone }}"
            data-interval ="{{ interval }}"
            data-timeformat ="{{ timeformat }}"
            data-quicksave ="{{ quicksave }}"
            data-weekdays ="{{ weekdays }}"
            data-months ="{{ months }}"
            data-today ="{{ today }}"

            data-datalist_download_url="{% url 'datalist_download_url' %}"
            data-scheme_template_upload_url="{% url 'scheme_template_upload_url' %}"
            data-schemeitem_upload_url= "{% url 'schemeitem_upload_url' %}"
            data-schemeitem_fill_url= "{% url 'schemeitem_fill_url' %}"
            data-schemeitems_download_url= "{% url 'schemeitems_download_url' %}"
            data-scheme_upload_url="{% url 'scheme_upload_url' %}"
            data-schemeorshiftorteam_upload_url="{% url 'schemeorshiftorteam_upload_url' %}"
            data-teammember_upload_url="{% url 'teammember_upload_url' %}"

            data-emplhour_fill_rosterdate_url="{% url 'emplhour_fill_rosterdate_url' %}"


            data-err_msg01= "{% trans 'An error occurred.' %}"
            data-err_msg_order="{% trans 'Please select an order.' %}"
            data-err_msg_customer="{% trans 'Please select a customer.' %}"
            data-err_msg_template_select="{% trans 'Please select a template.' %}"
            data-err_msg_name_exists= "{% trans 'This name already exists. Please enter a different name.' %}"
            data-err_msg_name_blank= "{% trans 'Name cannot be blank. Please enter a name.' %}"
            data-err_msg_code= "{% trans 'Please enter the name of the scheme.' %}"
            data-err_msg_cycle= "{% trans 'Please enter the number of cycle days.' %}"
            data-err_msg_template_blank = "{% trans 'Please enter a template name.' %}"

            data-txt_save = "{% trans 'Save' %}"
            data-txt_quicksave = "{% trans 'Quick save' %}"
            data-txt_quicksave_remove = "{% trans 'Exit Quick save' %}"

            data-txt_customer = "{% trans 'Customer' %}"
            data-txt_select_customer= "{% trans 'Select customer' %}"
            data-txt_select_customer_none= "{% trans 'No customers' %}"
            data-txt_order= "{% trans 'Order' %}"
            data-txt_select_order= "{% trans 'Select order' %}"
            data-txt_select_order_none= "{% trans 'No orders' %}"
            data-txt_select_scheme= "{% trans 'Select scheme' %}"
            data-txt_select_scheme_none= "{% trans 'No schemes' %}"

            data-txt_date= "{% trans 'Date' %}"
            data-txt_scheme= "{% trans 'Scheme' %}"
            data-txt_scheme_add= "{% trans 'Add scheme' %}"
            data-txt_copyfrom_select_template= "{% trans 'Select template' %}"
            data-txt_copyfrom_select_none= "{% trans 'No templates' %}"
            data-txt_scheme_from_template= "{% trans 'Copy from template' %}"
            data-txt_scheme_to_template= "{% trans 'Copy to template' %}"
            data-txt_show_templates= "{% trans 'Show templates' %}"
            data-txt_hide_templates="{% trans 'Hide templates' %}"
            data-txt_cycle_once= "{% trans 'Once only' %}"

            data-txt_rosterdate= "{% trans 'Rosterdate' %}"
            data-txt_fill_roster = "{% trans 'Fill roster' %}"
            data-txt_of = "{% trans 'of' %}"
            data-txt_shift= "{% trans 'Shift' %}"
            data-txt_shifts= "{% trans 'Shifts' %}"
            data-txt_shift_rest= "{% trans 'Rest shift' %}"
            data-txt_shift_add= "{% trans 'Add shift' %}"
            data-txt_shift_enter= "{% trans 'Enter shift' %}"
            data-txt_shift_delete= "{% trans 'Delete shift' %}"
            data-txt_show_shifts= "{% trans 'Go to shifts' %}"

            data-txt_team= "{% trans 'Team' %}"
            data-txt_teams= "{% trans 'Teams' %}"
            data-txt_team_add= "{% trans 'Add new team' %}"
            data-txt_team_delete= "{% trans 'Delete team' %}"
            data-txt_show_teams= "{% trans 'Go to teams' %}"

            data-txt_employee = "{% trans 'Employee' %}"
            data-txt_employees= "{% trans 'Employees' %}"
            data-txt_employee_select= "{% trans 'Select employee' %}"
            data-txt_employee_select_none= "{% trans 'No employees' %}"
            data-txt_employee_add= "{% trans 'Add employee' %}"
            data-txt_employee_enter= "{% trans 'Enter employee' %}"
            data-txt_employee_replacement= "{% trans 'Replacement employee' %}"
            data-txt_employee_replacement_add= "{% trans 'Add replacement employee' %}"

            data-txt_datefirst= "{% trans 'Start date' %}"
            data-txt_datelast= "{% trans 'End date' %}"
            data-txt_pricerate= "{% trans 'Hourly rate' %}"
            data-txt_billable = "{% trans 'Billable' %}"

            data-txt_timestart= "{% trans 'Start time' %}"
            data-txt_timeend= "{% trans 'End time' %}"
            data-txt_break= "{% trans 'Break' %}"

            data-timepicker_curday= "{% trans 'Current day' %}"
            data-timepicker_prevday= "{% trans 'Previous day' %}"
            data-timepicker_nextday= "{% trans 'Next day' %}"
            data-timepicker_prevday_info= "{% trans 'Shift starts on the previous day' %}"
            data-timepicker_nextday_info= "{% trans 'Shift ends on the next day' %}"

            data-msg_confirm_del1= "{% trans 'Do you want to delete the shift of' %}"
            data-msg_confirm_del2= "{% trans 'Do you want to delete this shift?' %}"

            data-msg_confdel_si_hdr= "{% trans 'Delete scheme shifts' %}"
            data-msg_confdel_si_01= "{% trans 'All shifts of this scheme will be deleted.' %}"

            data-title_billable= "{% trans 'Billable hours. Changes in worked hours will also change the billing hours.' %}"
            data-title_notbillable=  "{% trans 'Fixed billing hours. Changes in worked hours will not affect the billing hours.' %}"
            data-title_restshift =  "{% trans 'Rest shift' %}"
        >
        </div>

        <datalist id="id_datalist_employees"></datalist>
    {% else %}
        <div class="alert alert-danger">{% trans 'Error' %}</div>
        <a href="{% url 'home' %}" class="btn btn-outline-primary">{% trans 'Cancel' %}</a>
    {% endif %}
{% endblock %}